# CẤU HÌNH SERVER OPEN VPN (server.conf)
# TẠI: C:\Program Files\OpenVPN\config

# ===============================================
# 1. CẤU HÌNH CƠ BẢN VÀ GIAO THỨC
# ===============================================
port 1194
proto udp
dev tun

# ===============================================
# 2. KHÓA VÀ CHỨNG CHỈ (ĐƯỜNG DẪN MẶC ĐỊNH EASY-RSA)
# ===============================================
# Chứng chỉ Cơ quan cấp phát (CA)
ca "C:\\Program Files\\OpenVPN\\easy-rsa\\pki\\ca.crt"
# Chứng chỉ Server
cert "C:\\Program Files\\OpenVPN\\easy-rsa\\pki\\issued\\server.crt"
# Khóa riêng Server
key "C:\\Program Files\\OpenVPN\\easy-rsa\\pki\\private\\server.key"
# Khóa Diffie-Hellman
dh "C:\\Program Files\\OpenVPN\\easy-rsa\\pki\\dh.pem" 
# Khóa TLS-Auth (HMAC Key) - 0 nghĩa là Server
tls-auth "C:\\Program Files\\OpenVPN\\bin\\ta.key" 0

# ===============================================
# 3. CẤU HÌNH MẠNG VPN (INTERNAL)
# ===============================================
# Dải IP nội bộ dành riêng cho VPN clients (Ví dụ: 10.8.0.x)
server 10.8.0.0 255.255.255.0

# QUAN TRỌNG: ĐẨY ĐỊNH TUYẾN ĐẾN MẠNG LAN TRỤ SỞ
# THAY THẾ [MẠNG LAN CỦA BẠN] BẰNG IP LAN THỰC TẾ (Ví dụ: 192.168.1.0/24)
push "route 192.168.1.0 255.255.255.0"

# Đẩy DNS Server
push "dhcp-option DNS 8.8.8.8"

# ===============================================
# 4. FIX LỖI KHỞI ĐỘNG VÀ LOG (QUAN TRỌNG ĐỂ SERVER CHẠY)
# ===============================================

# FIX: Khắc phục lỗi định tuyến/max-routes trên Windows
route-method exe
route-delay 5

# FIX: Chỉ định Log tường minh (Đảm bảo C:\OpenVPN\log\ đã được tạo)
log "C:\\OpenVPN\\log\\openvpn.log"
status "C:\\OpenVPN\\log\\openvpn-status.log"
verb 3
explicit-exit-notify 1

# ===============================================
# 5. TỐI ƯU HÓA
# ===============================================
client-to-client
cipher AES-256-CBC
auth SHA256
compress lz4-v2
keepalive 10 120
persist-key
persist-tun